---
title: "Report for a RCBD"
author: '`r params$author`'
date: '`r format(Sys.time(), "%B %d, %Y")`'
output: 
  html_document:
    theme: united
  pdf_document:
    toc: true
    highlight: zenburn
  word_document:
    highlight: "tango"
params: 
  trait: "no data"
  treat: "no data"
  rep: "no data"
  data: "no data"
  maxp: "no data"
  author: "no data"
---

```{r, echo = FALSE}
trait <- params$trait
treat <- params$treat
rep <- params$rep
data <- params$data
maxp <- params$maxp

lc <- st4gi::checkdata01(trait, treat, rep, data)
model <- suppressWarnings(st4gi::rcbd(trait, treat, rep, data, maxp))
if (lc$c3 == 0)
  data[, trait] <- st4gi::mveb(trait, treat, rep, data, maxp)[, 4]
```

`r if(lc$c1 == 1 & lc$c2 == 1) {"You have fitted a linear model for a RCBD. The ANOVA table for your model is:"}`

```{r, echo = FALSE}
model
```

`r if(lc$c3 == 0) paste("You have some missing values (", format(lc$pmis * 100, digits = 3), "%) and they have been estimated before running ANOVA.")`

The p-value for treatments is `r format(model[1, 5], digits = 4)`
`r if(model[1, 5] < 0.05) {"which is significant at the 5% level."}`
`r if(model[1, 5] > 0.05) {"which is not significant at the 5% level."}`

The means of your treatments are:
```{r, echo = FALSE}
tapply(data[, trait], data[, treat], mean)
```

`r if(lc$nt < 10) {"It is always good to have some visualization of the data. Because the number of treatments in your experiment is not so big, we can plot the data for each treatment:"}`

```{r, echo = FALSE}
if (lc$nt < 10) msdplot(trait, treat, data, conf = 1)
```

Don't forget the assumptions of the model. It is supposed that the error has a normal distribution with the same variance for all the treatments. The following plots must help you evaluate this:

Funnel shapes for the first plot may suggest heterogeneity of variances while departures from the theoretical normal line are symptoms of lack of normality.
