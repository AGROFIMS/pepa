---
title: "Automatic report for an Augmented Block Design (ABD)"
author: '`r params$author`'
date: '`r format(Sys.time(), "%B %d, %Y")`'
output: 
  html_document:
    theme: united
    toc: true
    toc_depth: 3
  pdf_document:
    toc: true
    toc_depth: 3
    highlight: zenburn
  word_document:
    highlight: "tango"
    toc: true
    toc_depth: 3
params: 
  traits: "no data"
  treat: "no data"
  rep: "no data"
  data: "no data"
  author: "no data"
---

```{r, echo = FALSE}
library(knitr)

traits <- params$traits
treat <- params$treat
rep <- params$rep
data <- params$data

lc <- st4gi::check.abd(traits[1], treat, rep, data)
```

# 1. Model specification and data description

There are data for `r lc$nt.new` genotypes tested using an augmented block design with `r lc$nr` blocks and `r lc$nt.check` checks in each block. The statistical model is
$$
y_{ij} = \mu + \tau_i + \beta_j + \epsilon_{ij}
$$
where

* $y_{ij}$ is the observed response with treatment $i$ and block $j$.
* $\mu$ is the mean response over all treatments and blocks.
* $\tau_i$ is the effect for treatment $i$.
* $\beta_j$ is the effect for block $j$.
* $\epsilon_{ij}$ is the error term.

In this model we assume that the errors are independent and have a normal distribution with common variance, that is, $\epsilon_{ij} \sim N(0,\sigma_{\epsilon}^2)$.

```{r, include = FALSE}
out <- NULL

for (i in 1:length(traits)) {
  
  lc <- st4gi::check.abd(traits[i], treat, rep, data)
  
  if (lc$nt.check.0 > 0) {
    temp <- subset(data, !(data[, treat] %in% lc$check.0) & !is.na(data[, traits[i]]))
  } else {
    temp <- subset(data, !is.na(data[, traits[i]]))
  }
  
  if (lc$nt.check.2 > 1) {
    out <- c(out, knit_expand('child_abd.Rmd'))
  } else {
    out <- c(out, knit_expand('child_abd_fail.Rmd'))
  }
}
```

`r paste(knit(text = out), collapse = '\n')`
